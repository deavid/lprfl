<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">

<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>Borrowing - Learn Programming with Rust as a first language</title>


    <!-- Custom HTML head -->
    
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff" />

    <link rel="icon" href="../favicon.svg">
    <link rel="shortcut icon" href="../favicon.png">
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/general.css">
    <link rel="stylesheet" href="../css/chrome.css">
    <link rel="stylesheet" href="../css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
    <link rel="stylesheet" href="../fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="../highlight.css">
    <link rel="stylesheet" href="../tomorrow-night.css">
    <link rel="stylesheet" href="../ayu-highlight.css">

    <!-- Custom theme stylesheets -->
    <link rel="stylesheet" href="../styles.css">

    <!-- MathJax -->
    <script async type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>

<body>
    <!-- Provide site root to javascript -->
    <script type="text/javascript">
        var path_to_root = "../";
        var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
    </script>

    <!-- Work around some values being stored in localStorage wrapped in quotes -->
    <script type="text/javascript">
        try {
            var theme = localStorage.getItem('mdbook-theme');
            var sidebar = localStorage.getItem('mdbook-sidebar');

            if (theme.startsWith('"') && theme.endsWith('"')) {
                localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
            }

            if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
            }
        } catch (e) { }
    </script>

    <!-- Set the theme before any content is loaded, prevents flash -->
    <script type="text/javascript">
        var theme;
        try { theme = localStorage.getItem('mdbook-theme'); } catch (e) { }
        if (theme === null || theme === undefined) { theme = default_theme; }
        var html = document.querySelector('html');
        html.classList.remove('no-js')
        html.classList.remove('light')
        html.classList.add(theme);
        html.classList.add('js');
    </script>

    <!-- Hide / unhide sidebar before it is displayed -->
    <script type="text/javascript">
        var html = document.querySelector('html');
        var sidebar = 'hidden';
        if (document.body.clientWidth >= 1080) {
            try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch (e) { }
            sidebar = sidebar || 'visible';
        }
        html.classList.remove('sidebar-visible');
        html.classList.add("sidebar-" + sidebar);
    </script>

    <nav id="sidebar" class="sidebar" aria-label="Table of contents">
        <div class="sidebar-scrollbox">
            <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded "><a href="../L01_starter.html"><strong aria-hidden="true">1.</strong> Level: Starter</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L01starter/001A_first_language.html"><strong aria-hidden="true">1.1.</strong> Your first programming language</a></li><li class="chapter-item expanded "><a href="../L01starter/002A_books.html"><strong aria-hidden="true">1.2.</strong> Related books</a></li><li class="chapter-item expanded "><a href="../L01starter/003A_setup.html"><strong aria-hidden="true">1.3.</strong> Setting up the computer</a></li><li class="chapter-item expanded "><a href="../L01starter/004A_first_program.html"><strong aria-hidden="true">1.4.</strong> Your first program</a></li><li class="chapter-item expanded "><a href="../L01starter/005A_to_the_IDE.html"><strong aria-hidden="true">1.5.</strong> Quick, to the IDE!</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L01starter/005B_saving_progress.html"><strong aria-hidden="true">1.5.1.</strong> Saving our progress</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../L02_novice.html"><strong aria-hidden="true">2.</strong> Level: Novice</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L02novice/006A_recipes.html"><strong aria-hidden="true">2.1.</strong> It's like cooking recipes, seriously</a></li><li class="chapter-item expanded "><a href="../L02novice/007A_little_boxes.html"><strong aria-hidden="true">2.2.</strong> Variables are like little boxes that store things inside</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L02novice/007B_ex_print_format.html"><strong aria-hidden="true">2.2.1.</strong> Exercise: Printing and Formatting</a></li></ol></li><li class="chapter-item expanded "><a href="../L02novice/007C_fun_with_libs.html"><strong aria-hidden="true">2.3.</strong> Having fun with libraries</a></li><li class="chapter-item expanded "><a href="../L02novice/008A_declaring.html"><strong aria-hidden="true">2.4.</strong> Declaring variables</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L02novice/008B_ex_variables.html"><strong aria-hidden="true">2.4.1.</strong> Exercise: Variables</a></li><li class="chapter-item expanded "><a href="../L02novice/008C_turtle.html"><strong aria-hidden="true">2.4.2.</strong> Let's try Turtle!</a></li></ol></li><li class="chapter-item expanded "><a href="../L02novice/009A_incrementing.html"><strong aria-hidden="true">2.5.</strong> Incrementing and decrementing</a></li><li class="chapter-item expanded "><a href="../L02novice/010A_looping.html"><strong aria-hidden="true">2.6.</strong> Looping' around</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L02novice/010B_ex_loops.html"><strong aria-hidden="true">2.6.1.</strong> Exercise: loops</a></li><li class="chapter-item expanded "><a href="../L02novice/010C_turtle_loops.html"><strong aria-hidden="true">2.6.2.</strong> Turtle: loops</a></li></ol></li><li class="chapter-item expanded "><a href="../L02novice/011A_comments.html"><strong aria-hidden="true">2.7.</strong> Adding some comments</a></li><li class="chapter-item expanded "><a href="../L02novice/012A_ifs.html"><strong aria-hidden="true">2.8.</strong> What If‚Ä¶?</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L02novice/012B_ex_ifs.html"><strong aria-hidden="true">2.8.1.</strong> Exercise: conditionals</a></li></ol></li><li class="chapter-item expanded "><a href="../L02novice/013A_loops_again.html"><strong aria-hidden="true">2.9.</strong> For loops again!</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L02novice/013B_other_loops.html"><strong aria-hidden="true">2.9.1.</strong> Other types of loops</a></li><li class="chapter-item expanded "><a href="../L02novice/013C_turtle_loops.html"><strong aria-hidden="true">2.9.2.</strong> Turtle: Improving with loops</a></li><li class="chapter-item expanded "><a href="../L02novice/013D_turtle_spiral.html"><strong aria-hidden="true">2.9.3.</strong> Turtle: Making a spiral</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../L03_apprentice.html"><strong aria-hidden="true">3.</strong> Level: Apprentice</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L03apprentice/014A_functions.html"><strong aria-hidden="true">3.1.</strong> Introducing Functions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L03apprentice/014B_func_return.html"><strong aria-hidden="true">3.1.1.</strong> Returning values from functions</a></li><li class="chapter-item expanded "><a href="../L03apprentice/014C_func_args.html"><strong aria-hidden="true">3.1.2.</strong> Function arguments</a></li></ol></li><li class="chapter-item expanded "><a href="../L03apprentice/015A_data_types.html"><strong aria-hidden="true">3.2.</strong> Data types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L03apprentice/015B_rust_types.html"><strong aria-hidden="true">3.2.1.</strong> Rust data types</a></li></ol></li><li class="chapter-item expanded "><a href="../L03apprentice/016A_typedvars.html"><strong aria-hidden="true">3.3.</strong> Back to declaring variables‚Ä¶ with type</a></li><li class="chapter-item expanded "><a href="../L03apprentice/016B_dbg_format.html"><strong aria-hidden="true">3.4.</strong> dbg!() and format!()</a></li><li class="chapter-item expanded "><a href="../L03apprentice/017A_conversions.html"><strong aria-hidden="true">3.5.</strong> Converting types with explicit conversions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L03apprentice/017B_ex_conversions.html"><strong aria-hidden="true">3.5.1.</strong> Exercise: explicit conversions</a></li></ol></li><li class="chapter-item expanded "><a href="../L03apprentice/018A_strings_intro.html"><strong aria-hidden="true">3.6.</strong> A tiny bit on strings</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L03apprentice/018B_strings_and_str.html"><strong aria-hidden="true">3.6.1.</strong> Simple explanation on &str vs String</a></li></ol></li><li class="chapter-item expanded "><a href="../L03apprentice/X03A_funcs_revisited.html"><strong aria-hidden="true">3.7.</strong> A bit more detailed explanation on functions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L03apprentice/014D_closures.html"><strong aria-hidden="true">3.7.1.</strong> Closures</a></li></ol></li><li class="chapter-item expanded "><a href="../L03apprentice/020A_proj_game_macroquad.html"><strong aria-hidden="true">3.8.</strong> Project: A simple game with Macroquad</a></li></ol></li><li class="chapter-item expanded "><a href="../L04_adept.html"><strong aria-hidden="true">4.</strong> Level: Adept</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L04adept/020A_structs.html"><strong aria-hidden="true">4.1.</strong> Not everything are numbers and texts: Structs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L04adept/020B_struct_impl.html"><strong aria-hidden="true">4.1.1.</strong> Struct-specific functions, really?</a></li><li class="chapter-item expanded "><a href="../L04adept/020C_oop.html"><strong aria-hidden="true">4.1.2.</strong> OOP? More like OP</a></li></ol></li><li class="chapter-item expanded "><a href="../L04adept/021A_enums.html"><strong aria-hidden="true">4.2.</strong> Enums!</a></li><li class="chapter-item expanded "><a href="../L04adept/022A_match.html"><strong aria-hidden="true">4.3.</strong> Match!</a></li><li class="chapter-item expanded "><a href="../L04adept/023A_float_gotchas.html"><strong aria-hidden="true">4.4.</strong> Floating point gotchas</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.5.</strong> Data Structures</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">4.5.1.</strong> Lists</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.5.2.</strong> Tuples</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.5.3.</strong> Slices</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.5.4.</strong> HashMaps</div></li></ol></li><li class="chapter-item expanded "><a href="../L04adept/023A_proj_game_ggez.html"><strong aria-hidden="true">4.6.</strong> Project: A simple game with ggez</a></li></ol></li><li class="chapter-item expanded "><a href="../L05_master.html"><strong aria-hidden="true">5.</strong> Level: Master</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../L05master/X02A_datatypes.html"><strong aria-hidden="true">5.1.</strong> What are those other data types for?</a></li><li class="chapter-item expanded "><a href="../L05master/023A_borrowing.html" class="active"><strong aria-hidden="true">5.2.</strong> Borrowing</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.3.</strong> Lifetimes</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.4.</strong> Generic parameters</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.5.</strong> Data Structures</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">5.5.1.</strong> Lists again!</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">5.5.1.1.</strong> Deques and ring buffers</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.5.2.</strong> HashMaps again!</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">5.5.2.1.</strong> HashSets, what?</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.5.3.</strong> The infamous linked list</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.5.4.</strong> Trees</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.5.5.</strong> Heaps</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.6.</strong> Algorithms</div></li></ol></li><li class="chapter-item expanded "><a href="../L06_grandmaster.html"><strong aria-hidden="true">6.</strong> Level: Grand Master</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.1.</strong> A glance over macros</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.2.</strong> Polymorphism (Traits)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.3.</strong> Functional programming</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.3.1.</strong> Iterators</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.4.</strong> Smart Pointers</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.4.1.</strong> Box</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.4.2.</strong> Rc</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.4.3.</strong> RefCell</div></li></ol></li><li class="chapter-item expanded "><a href="../L06grandmaster/X04A_garbage_collector.html"><strong aria-hidden="true">6.5.</strong> What is a Garbage Collector?</a></li></ol></li><li class="chapter-item expanded "><a href="../L07_legendary.html"><strong aria-hidden="true">7.</strong> Level: Legendary</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">7.1.</strong> Polymorphism (dyn Box)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.2.</strong> No Size? ?Sized</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.3.</strong> Threading</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">7.3.1.</strong> Mutexes/Locks</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.3.2.</strong> Atomics</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.4.</strong> Async</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.5.</strong> Databases and SQL</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">7.5.1.</strong> What about NoSQL?</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.6.</strong> Web applications!</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">7.6.1.</strong> HTML+CSS+JS in one shot</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.6.2.</strong> Web servers</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.6.3.</strong> REST services</div></li><li class="spacer"></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../X01A_TODO.html"><strong aria-hidden="true">8.</strong> To-do: pieces that need more work</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../Y01A_appendices.html"><strong aria-hidden="true">9.</strong> Appendices</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Y02A_license.html"><strong aria-hidden="true">9.1.</strong> Appendix A. License of this book</a></li><li class="chapter-item expanded "><a href="../Y03A_caveats.html"><strong aria-hidden="true">9.2.</strong> Appendix B. Caveats and challenges in this book</a></li><li class="chapter-item expanded "><a href="../Y04A_solutions.html"><strong aria-hidden="true">9.3.</strong> Appendix C. Exercises and Solutions</a></li><li class="chapter-item expanded "><a href="../Y05A_projects.html"><strong aria-hidden="true">9.4.</strong> Appendix D. Proposed projects</a></li><li class="chapter-item expanded "><a href="../Y06A_rust_compared.html"><strong aria-hidden="true">9.5.</strong> Appendix E. Rust compared to other languages</a></li></ol></li></ol>
        </div>
        <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
    </nav>

    <div id="page-wrapper" class="page-wrapper">

        <div class="page">
                        <div id="menu-bar-hover-placeholder"></div>
            <div id="menu-bar" class="menu-bar sticky bordered">
                <div class="left-buttons">
                    <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                        <i class="fa fa-bars"></i>
                    </button>
                    <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                        <i class="fa fa-paint-brush"></i>
                    </button>
                    <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                        <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button>
                        </li>
                    </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                        aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                        aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
                </div>

                <h1 class="menu-title">ü¶Ä Learn Programming with Rust as a first language</h1>

                <div class="right-buttons">
                    <a href="../print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>

                </div>
            </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..."
                        aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>

            <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
            <script type="text/javascript">
                document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                    link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                });
            </script>

            <div id="content" class="content">
                <main>
                    <h1 id="borrowing"><a class="header" href="#borrowing">Borrowing</a></h1>
<p>This is most probably the most difficult concept in Rust. Borrowing is very 
specific to Rust only, and it‚Äôs the main reason so many people abandon learning 
Rust. And also it is why so many people say Rust is difficult.</p>
<p>Learning this is what sets apart developers from Rust Developers.</p>
<p>Are you ready?</p>
<ul>
<li>When you see things like <code>x</code>, <code>y</code>, <code>f64</code>, etc. It means that you own the 
variable, meaning that you can do whatever: read, write and free their memory.</li>
<li>If you see <code>&amp;x</code>, <code>&amp;y</code>, <code>&amp;f64</code>, etc. Means that you don‚Äôt own it, it was lent
to you temporarily. You can only read their contents, but most of the time you
can also copy the contents elsewhere too.</li>
<li>Finally, if you see <code>&amp;mut x</code>, <code>&amp;mut y</code>, <code>&amp;mut f64</code>, etc. Is as before, but
you can also write to them. With these you can do mostly everything except
free their memory.</li>
</ul>
<p>That‚Äôs it. <code>&amp;</code> is read-only access, <code>&amp;mut</code> is read and write access, and if 
nothing appears, it‚Äôs full access.</p>
<p>Wait, you thought this was going to be more difficult? I wonder why.</p>
<p>Ok, jokes aside, now comes the difficult part.</p>
<p>Rust will ensure the correctness of our programs in a way that feels ‚Äútoo much‚Äù,
it will analyze and prove correctness to a level that no other language that I
know does.</p>
<p>This makes the Rust compiler very picky. There‚Äôs lots of stuff that it doesn‚Äôt
like. And it‚Äôs hard to make the compiler happy.</p>
<p>Maybe you experienced this already. Or maybe I did a good job up to now keeping
you away from this. Now it‚Äôs time to start introducing (very gently) to 
Ownership and Borrowing in Rust.</p>
<p>When we store a value into a variable, it uses some amount of memory 
of the computer. It seems kinda obvious that 100 numbers will use more memory
than 5 numbers.</p>
<p>And memory needs to be freed. Because if we keep asking for memory and never
returning it, our computer might run out of memory at some point.</p>
<p>Therefore, Rust must allocate (ask for memory) when we put a new variable, and
it must free the memory when it‚Äôs no longer needed.</p>
<pre><pre class="playground"><code class="language-rust edition2021">fn some_function() {
    let x: i64 = 12345; // &lt;-- memory gets allocated here.
    println!(&quot;using the variable: {}&quot;, x);
} // &lt;-- memory gets freed here, when the function ends.

fn main() {
    some_function();
}
</code></pre></pre>
<p>Now, this is the basic of what Ownership means: when we create something, we 
own it, and we‚Äôre responsible for freeing it when we‚Äôre done with it.</p>
<p>Rust does this for us in a very natural way. So much that we could ignore
this up to this point.</p>
<p>The problem with this approach is that, when we pass a variable to a function,
the function now owns that variable. And this means that the function will
free this variable when it ends, we could not use it anymore.</p>
<p>Sounds weird, but it will seem clear here:</p>
<pre><pre class="playground"><code class="language-rust edition2021">fn print(x: i64) { // &lt;-- x ownership is captured when calling the function.
    println!(&quot;Value is: {}&quot;, x);
} // &lt;-- memory gets freed here, when the function ends.

fn some_function() {
    let x: i64 = 12345; // &lt;-- memory gets allocated here.
    print(x); // &lt;-- we call the function, but 'x' is now owned by 'print'.
    println!(&quot;using the variable: {}&quot;, x); // &lt;-- 'x' no longer exists!!
}

fn main() {
    some_function();
}
</code></pre></pre>
<p>But ‚ÄîI hear you asking‚Äî, if I run the above code it works.</p>
<p>Yeah, I know. But this one does not:</p>
<pre><pre class="playground"><code class="language-rust edition2021">fn print(x: String) { // &lt;-- x ownership is captured when calling the function.
    println!(&quot;Value is: {}&quot;, x);
} // &lt;-- memory gets freed here, when the function ends.

fn some_function() {
    let x: String = &quot;text&quot;.to_string(); // &lt;-- memory gets allocated here.
    print(x); // &lt;-- we call the function, but 'x' is now owned by 'print'.
    println!(&quot;using the variable: {}&quot;, x); // &lt;-- 'x' no longer exists!!
}

fn main() {
    some_function();
}
</code></pre></pre>
<p>Some data types are so simple that Rust can just copy them around. But text
in the other hand, is a bit more complicated and that trick no longer works<sup class="footnote-reference"><a href="#1">1</a></sup>.</p>
<p>Now, to make this work is pretty easy. Because <code>print()</code> is only reading, we
only need read-only access. We can use the ampersand to borrow temporarily
the variable:</p>
<pre><pre class="playground"><code class="language-rust edition2021">fn print(x: &amp;String) { // &lt;-- we only get a &quot;reference&quot; to 'x'. We don't own it.
    println!(&quot;Value is: {}&quot;, x);
} 

fn some_function() {
    let x: String = &quot;text&quot;.to_string(); // &lt;-- memory gets allocated here.
    print(&amp;x); // &lt;-- now we only lent 'x'. We keep ownership.
    println!(&quot;using the variable: {}&quot;, x); // &lt;-- 'x' does exist here and works.
} // &lt;-- 'x' memory gets freed here.

fn main() {
    some_function();
}
</code></pre></pre>
<p>As you can see, I only added two <code>&amp;</code> in the code, and we don‚Äôt have the 
problem anymore.</p>
<p>Now we also have <code>&amp;mut</code>, and this one is fascinating. It allows us to
do this:</p>
<pre><pre class="playground"><code class="language-rust edition2021">fn add_five(x: &amp;mut i64) { 
    x += 5
} 

fn some_function() {
    let x: i64 = 100; 
    println!(&quot;x = {}&quot;, x); 
    add_five(&amp;mut x); 
    println!(&quot;x = {}&quot;, x); 
    add_five(&amp;mut x); 
    println!(&quot;x = {}&quot;, x); 
}

fn main() {
    some_function();
}
</code></pre></pre>
<p>Because <code>add_five</code> receives a mutable reference, when we change it, we will see
the changes appear on <code>some_function</code>.</p>
<p>I think you can see this is super useful, and our functions got now superpowers!</p>
<p>Let‚Äôs step this up a little.</p>
<p>Turns out you can also store references like <code>&amp;x</code> or <code>&amp;mut x</code>. And for what 
reason do we want to do this? Well‚Ä¶ it‚Äôs too early to explain. Let‚Äôs just say
that it is possible, and you don‚Äôt want to do this.</p>
<pre><pre class="playground"><code class="language-rust edition2021">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut x = 5;
let y = &amp;mut x;
*y = 3;
println!(&quot;x = {}&quot;, x);
<span class="boring">}
</span></code></pre></pre>
<p>Also in structs:</p>
<pre><pre class="playground"><code class="language-rust edition2021">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Thingy {
    x: &amp;mut i64,
    y: &amp;f64,
}
<span class="boring">}
</span></code></pre></pre>
<p>But this must be written as:</p>
<pre><pre class="playground"><code class="language-rust edition2021">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Thingy&lt;'a&gt; {
    x: &amp;'a mut i64,
    y: &amp;'a f64,
}
<span class="boring">}
</span></code></pre></pre>
<p>The point is: it is possible. And I need you to know that this can be done to 
understand the next explanation.</p>
<p>But at your current level, if you see yourself coding something like that, 
simply back off and find a way to avoid storing references <code>&amp;var</code> <code>&amp;mut var</code>. 
They‚Äôre very painful to work with.</p>
<p>Now, this means that there may exist several pieces of code that have access
to the same variable at the same time via different methods.</p>
<p>And this is a problem.</p>
<p>If one part of a program is using a variable and another part, inadvertently is
changing the variable‚Ä¶ well, it can end very badly.</p>
<p>For this reason, Rust limits how ownership and references can coexist, and how 
many we can have.</p>
<ul>
<li>Ownership (<code>var</code>): There can be only one owner at a time. When we call a function, we 
transfer the ownership of the variables unless they are references <code>&amp;x</code> <code>&amp;mut x</code>.</li>
<li>Mutable reference (<code>&amp;mut var</code>): There must be at most one <code>&amp;mut var</code> at any time.
And while it exists, the original variable cannot be read or written (more or less).</li>
<li>Shared reference (<code>&amp;var</code>): There can be many, but they cannot coexist with <code>&amp;mut var</code>.</li>
</ul>
<p>In other words, there must be always one owner, and one writer. Readers can be 
many, as long as there aren‚Äôt anyone writing.</p>
<p>The ownership system in Rust can be related with having a car:</p>
<ul>
<li><code>var</code>: You own a car, therefore you can choose to dispose of it at any time.</li>
<li><code>&amp;mut var</code>: You send the car to a mechanic, they can do changes to your car, 
but you cannot use it meanwhile. And you cannot dispose of it while is on 
the mechanic.</li>
<li><code>&amp;var</code>: You let others see your parked car, but not touch it. Many can see 
your car at the same time, but meanwhile you cannot use it or send it to the
mechanic.</li>
</ul>
<p>Which roughly translates into:</p>
<pre><pre class="playground"><code class="language-rust edition2021">struct Car {
    horses: i64,
    air_conditioner: bool,
}

fn buy_cheap_car() -&gt; Car {
    return Car{horses: 60, air_conditioner: false};
}

impl Car {
    // &quot;self&quot; here transfers ownership. And this function will free the variable.
    fn dispose(self) {
        println!(&quot;Bye car! {} horses, A/C:{}&quot;, self.horses, self.air_conditioner);
    }
    // &quot;&amp;mut self&quot; gives exclusive write access.
    fn upgrade_ac(&amp;mut self) {
        self.air_conditioner = true;
    }
    fn upgrade_engine(&amp;mut self) {
        self.horses += 10;
    }
    // &quot;&amp;self&quot; gives shared read access.
    fn admire(&amp;self) {
        println!(
            &quot;Woo, nice car with {} horses and {} A/C&quot;, 
            self.horses, 
            self.air_conditioner
            );
    }
}

fn main() {
    let mut mycar = buy_cheap_car();
    let admirer1 = &amp;mycar;
    admirer1.admire();
    
    let mechanic = &amp;mut mycar;
    mechanic.upgrade_ac();

    let admirer1 = &amp;mycar;
    let admirer2 = &amp;mycar;
    // mechanic can't be used here.
    admirer1.admire();
    admirer2.admire();

    let mechanic = &amp;mut mycar;
    mechanic.upgrade_engine();

    let admirer1 = &amp;mycar;
    let admirer2 = &amp;mycar;
    admirer1.admire();
    admirer2.admire();

    mycar.dispose();
    // Car no longer exists, this won't work:
    // let admirer1 = &amp;mycar;
    // admirer1.admire();
}
</code></pre></pre>
<p>I know that at this point this will feel confusing. It‚Äôs a lot to unpack.</p>
<p>And I guess you have questions like:</p>
<ul>
<li>Why should I use this?</li>
<li>Seems complicated.</li>
<li>Why not use <code>&amp;mut</code> all the time? Or just the regular <code>var</code>.</li>
<li>Is this to put restrictions on the code?</li>
</ul>
<p>No, no‚Ä¶ forget about all those thoughts. </p>
<p>It‚Äôs not something we want to use, it‚Äôs something that we will need to use.
Meaning, that the usage will be apparent soon enough. Don‚Äôt overthink it.</p>
<p>We‚Äôre trying to solve a problem here. The problem is sharing variables across
many pieces of code.</p>
<p>Before, we were doing lots of things like:</p>
<pre><pre class="playground"><code class="language-rust edition2021">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let p: Point2D;
// (...)
p = p.move(distance_vector);
<span class="boring">}
</span></code></pre></pre>
<p>But this is inconvenient. And we would like to just write:</p>
<pre><pre class="playground"><code class="language-rust edition2021">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let p: Point2D;
// (...)
p.move(distance_vector);
<span class="boring">}
</span></code></pre></pre>
<p>And that should update the point. </p>
<p>For that, we want to use <code>&amp;mut self</code> instead. So, we had:</p>
<pre><pre class="playground"><code class="language-rust edition2021">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Point2D {
    fn move(mut p: Self, v: Vector2D) { 
        p.x += v.dx;
        p.y += v.dy;
        return p;
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>With what we learned, we can do:</p>
<pre><pre class="playground"><code class="language-rust edition2021">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Point2D {
    fn move(&amp;mut self, v: Vector2D) { 
        self.x += v.dx;
        self.y += v.dy;
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>And now that updates the point. Nice.</p>
<p>Still one problem. If we do:</p>
<pre><pre class="playground"><code class="language-rust edition2021">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut p1 = Point2D{x: 10.0, y: -5.0};
let mut p2 = Point2D{x: 5.0, y: 15.0};
let distance_vector = Vector2D{dx: 50.0, dy:0.0};
// (...)
p1.move(distance_vector);
p2.move(distance_vector);
<span class="boring">}
</span></code></pre></pre>
<p>The second move, for <code>p2</code> won‚Äôt work. The problem is that <code>move</code> is taking
ownership of <code>distance_vector</code>, so we lose the variable.</p>
<p>But we don‚Äôt need ownership just for reading the contents, do we?</p>
<p>So let‚Äôs update that:</p>
<pre><pre class="playground"><code class="language-rust edition2021">struct Point2D {
    x: f64,
    y: f64,
}

struct Vector2D {
    dx: f64,
    dy: f64,
}

impl Point2D {
    // Added ampersand         v---- here
    fn translate(&amp;mut self, v: &amp;Vector2D) { 
        self.x += v.dx;
        self.y += v.dy;
    }
}

fn main() {
    let mut p1 = Point2D{x: 10.0, y: -5.0};
    let mut p2 = Point2D{x: 5.0, y: 15.0};
    let distance_vector = Vector2D{dx: 50.0, dy:0.0};
    // Added ampersand
    //           v---- here
    p1.translate(&amp;distance_vector);
    p2.translate(&amp;distance_vector);
}
</code></pre></pre>
<p>With just that single <code>&amp;</code> character, now it works.</p>
<p>I‚Äôll leave this here. Take it as an introduction into borrowing and ownership. 
Later on we will revisit this topic a bit more in-depth. So if it‚Äôs not fully
clear, don‚Äôt worry!</p>
<p>Also, we‚Äôre reaching a point where you can already read (and probably write) 
what could be production-ready Rust code. This is (almost) what real code looks
like. You‚Äôre getting close to be able to start your own applications!</p>
<hr />
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>If you ever asked yourself why all code samples and exercises I wrote 
almost always had number variables, this is the reason. They‚Äôre easier to work 
with and avoids these problems.</p>
</div>

                </main>

                <nav class="nav-wrapper" aria-label="Page navigation">
                    <!-- Mobile navigation buttons -->
                    <a rel="prev" href="../L05master/X02A_datatypes.html" class="mobile-nav-chapters previous"
                        title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../L06_grandmaster.html" class="mobile-nav-chapters next"
                        title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>

                    <div style="clear: both"></div>
                </nav>
            </div>
        </div>

        <nav class="nav-wide-wrapper" aria-label="Page navigation">
            <a rel="prev" href="../L05master/X02A_datatypes.html" class="nav-chapters previous" title="Previous chapter"
                aria-label="Previous chapter" aria-keyshortcuts="Left">
                <i class="fa fa-angle-left"></i>
            </a>

            <a rel="next" href="../L06_grandmaster.html" class="nav-chapters next" title="Next chapter"
                aria-label="Next chapter" aria-keyshortcuts="Right">
                <i class="fa fa-angle-right"></i>
            </a>
        </nav>

    </div>

    <!-- Livereload script (if served using the cli tool) -->
    <script type="text/javascript">
        const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
        const socket = new WebSocket(wsAddress);
        socket.onmessage = function (event) {
            if (event.data === "reload") {
                socket.close();
                location.reload();
            }
        };

        window.onbeforeunload = function () {
            socket.close();
        }
    </script>



    <script type="text/javascript">
        window.playground_copyable = true;
    </script>


    <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

    <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
    <script src="../book.js" type="text/javascript" charset="utf-8"></script>

    <!-- Custom JS scripts -->


</body>

</html>